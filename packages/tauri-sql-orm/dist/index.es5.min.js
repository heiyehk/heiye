!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("tauri-plugin-sql-api")):"function"==typeof define&&define.amd?define(["exports","tauri-plugin-sql-api"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).hyjs={},t.SqlDatabase)}(this,(function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i,r=n(e),o=function(){function t(){}return t.TEXT="TEXT",t.INTEGER="INTEGER",t.REAL="REAL",t.BLOB="BLOB",t.NULL="NULL",t.BOOLEAN="BOOLEAN",t.DATE="DATE",t.DATEONLY="DATEONLY",t.TIME="TIME",t.NOW="NOW",t.UUID="UUID",t}(),a=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{s(i.next(t))}catch(t){o(t)}}function c(t){try{s(i.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((i=i.apply(t,e||[])).next())}))},c=function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},s={sqlite:"AUTOINCREMENT",mysql:"AUTO_INCREMENT",postgres:"SERIAL"},u=function(t,e){var n=Object.keys(t),i=Object.values(t);if(e.timestamps){if(e.createdAt){var r="string"==typeof e.createdAt?e.createdAt:"createdAt";n.push(r),i.push((new Date).toISOString())}if(e.updatedAt){var o="string"==typeof e.updatedAt?e.updatedAt:"updatedAt";n.push(o),i.push((new Date).toISOString())}if(e.deletedAt){var a="string"==typeof e.deletedAt?e.deletedAt:"deletedAt";n.push(a),i.push(null)}}return{keys:n,values:i}},l=function(){function t(){}return Object.defineProperty(t,"getDB",{get:function(){return this.db},enumerable:!1,configurable:!0}),Object.defineProperty(t,"getRawAttributes",{get:function(){return this.rawAttributes},enumerable:!1,configurable:!0}),Object.defineProperty(t,"getDBPath",{get:function(){return this.db.path},enumerable:!1,configurable:!0}),t.init=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),a(this,void 0,void 0,(function(){var i;return c(this,(function(r){switch(r.label){case 0:return i=this,[4,n.db];case 1:return i.db=r.sent(),this.modelName=t,this.rawAttributes=e,this.databaseType=n.databaseType,this.rawOptions=n,[2,this]}}))}))},t.sync=function(t){return a(this,void 0,void 0,(function(){var e,n,i,r,o,a,u,l=this;return c(this,(function(c){switch(c.label){case 0:if(!this.getRawAttributes)throw new Error("Model not initialized, attributes is undefined.");return t&&t.force?[4,this.drop()]:[3,2];case 1:c.sent(),c.label=2;case 2:return e=Object.keys(this.getRawAttributes),this.rawOptions.timestamps&&(this.rawOptions.createdAt&&(n="string"==typeof this.rawOptions.createdAt?this.rawOptions.createdAt:"createdAt",this.getRawAttributes[n]={type:"DATE",allowNull:!1},e.push(n)),this.rawOptions.updatedAt&&(i="string"==typeof this.rawOptions.updatedAt?this.rawOptions.updatedAt:"updatedAt",this.getRawAttributes[i]={type:"DATE",allowNull:!1},e.push(i)),this.rawOptions.deletedAt&&(r="string"==typeof this.rawOptions.deletedAt?this.rawOptions.deletedAt:"deletedAt",this.getRawAttributes[r]={type:"DATE"},e.push(r))),o=e.map((function(t){var e="".concat(t," ").concat(l.getRawAttributes[t].type);return!1===l.getRawAttributes[t].allowNull&&(e+=" NOT NULL"),l.getRawAttributes[t].primaryKey&&(e+=" PRIMARY KEY"),l.getRawAttributes[t].autoIncrement&&(e+=" ".concat(s[l.databaseType])),e})),a="CREATE TABLE IF NOT EXISTS ".concat(this.modelName," (\r\n      ").concat(o.join(", \r\n      "),"\r\n)"),[4,this.getDB.execute(a)];case 3:return u=c.sent(),this.rawOptions.initialAutoIncrement&&this.rawOptions.initialAutoIncrement>0?"sqlite"!==this.databaseType?[3,5]:[4,this.getDB.execute("UPDATE SQLITE_SEQUENCE SET seq = ".concat(this.rawOptions.initialAutoIncrement," WHERE name = '").concat(this.modelName,"';"))]:[3,7];case 4:return c.sent(),[3,7];case 5:return[4,this.getDB.execute("ALTER TABLE ".concat(this.modelName," AUTO_INCREMENT = ").concat(this.rawOptions.initialAutoIncrement,";"))];case 6:c.sent(),c.label=7;case 7:return[2,{result:u,modelName:this.modelName}]}}))}))},t.create=function(t){return a(this,void 0,void 0,(function(){var e,n,i,r;return c(this,(function(o){switch(o.label){case 0:return e=u(t,this.rawOptions),n=e.keys,i=e.values,r=Array(n.length).fill("?").join(", "),[4,this.getDB.execute("INSERT INTO ".concat(this.modelName," (").concat(n.join(", "),") VALUES (").concat(r,");"),i)];case 1:return[2,o.sent()]}}))}))},t.bulkCreate=function(t){return a(this,void 0,void 0,(function(){var e,n,i,r,o=this;return c(this,(function(a){switch(a.label){case 0:return e=u(t[0],this.rawOptions).keys,n=Array(e.length).fill("?").join(", "),i=t.map((function(t){return u(t,o.rawOptions).values})).flat(),r=Array(t.length).fill("(".concat(n,")")).join(", "),[4,this.getDB.execute("INSERT INTO ".concat(this.modelName," (").concat(e.join(", "),") VALUES ").concat(r),i).catch((function(t){throw new Error(t)}))];case 1:return[2,a.sent()]}}))}))},t.update=function(t,e){return a(this,void 0,void 0,(function(){var n,i,r;return c(this,(function(o){switch(o.label){case 0:return n=Object.keys(t),i=Object.values(t),r="UPDATE ".concat(this.modelName," SET "),"sqlite"===this.databaseType?r+="".concat(n.map((function(t){return"".concat(t," = ?")})).join(", ")," WHERE id = ").concat(e.where.id):"mysql"===this.databaseType?r+="SET ".concat(n.map((function(t){return"`".concat(t,"` = ?")})).join(", ")," WHERE `id` = ").concat(e.where.id):"postgres"===this.databaseType&&(r+="SET ".concat(n.map((function(t){return'"'.concat(t,'" = ?')})).join(", "),' WHERE "id" = ').concat(e.where.id)),[4,this.getDB.execute(r,i)];case 1:return[2,o.sent()]}}))}))},t.destroy=function(t){return a(this,void 0,void 0,(function(){var e,n;return c(this,(function(i){switch(i.label){case 0:return e=Object.keys(t),n=Object.values(t),[4,this.getDB.execute("DELETE FROM ".concat(this.modelName," WHERE ").concat(e.map((function(t){return"".concat(t," = ?")})).join(" AND ")," LIMIT 1"),n)];case 1:return[2,i.sent()]}}))}))},t.findOne=function(t){return a(this,void 0,void 0,(function(){var e,n;return c(this,(function(i){switch(i.label){case 0:return e=Object.keys(t),n=Object.values(t),[4,this.getDB.select("SELECT * FROM ".concat(this.modelName," WHERE ").concat(e.map((function(t){return"".concat(t," = ?")})).join(" AND ")," LIMIT 1"),n)];case 1:return[2,i.sent()]}}))}))},t.findAll=function(t){return void 0===t&&(t={}),a(this,void 0,void 0,(function(){var e,n,i,r,o,a,s,u,l,h,f;return c(this,(function(c){switch(c.label){case 0:return e=t.where,n=void 0===e?{}:e,i=t.limit,r=void 0===i?0:i,o=t.offset,a=void 0===o?0:o,s=t.order,u=void 0===s?[]:s,l=Object.keys(n),h=Object.values(n),f="SELECT * FROM ".concat(this.modelName),l.length&&(f+=" WHERE ".concat(l.map((function(t){return"".concat(t," = ?")})).join(" AND "))),u&&u.length&&(f+=" ORDER BY ".concat(u[0]," ").concat(u[1])),r&&(f+=" LIMIT ".concat(r)),a&&(f+=" OFFSET ".concat(a)),[4,this.getDB.select(f,h).catch((function(t){throw new Error(t)}))];case 1:return[2,c.sent()]}}))}))},t.execute=function(t,e){return a(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return e?[4,this.getDB.execute(t,e)]:[2,this.getDB.execute(t)];case 1:return n.sent(),[2]}}))}))},t.select=function(t,e){return a(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return e?[4,this.getDB.select(t,e)]:[2,this.getDB.select(t)];case 1:return n.sent(),[2]}}))}))},t.drop=function(){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.getDB.execute("DROP TABLE IF EXISTS ".concat(this.modelName))];case 1:return[2,t.sent()]}}))}))},t}(),h=(i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),f=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{s(i.next(t))}catch(t){o(t)}}function c(t){try{s(i.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((i=i.apply(t,e||[])).next())}))},d=function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},p=function(){function t(t){this.db=null,this.path="",this.databaseType="",this.path=t,this.databaseType=t.split(":")[0],this.connect()}return Object.defineProperty(t.prototype,"getDB",{get:function(){return this.db},enumerable:!1,configurable:!0}),t.prototype.define=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),f(this,void 0,void 0,(function(){var i,r;return d(this,(function(o){switch(o.label){case 0:return n.modelName=t,i=n,[4,this.getDB];case 1:return i.db=o.sent(),n.databaseType=this.databaseType,r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e}(l),r.init(t,e,n),[2,r]}}))}))},t.prototype.connect=function(t){return f(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this.path)throw new Error("Database path is not defined.");return this.db=r.default.load(this.path).catch((function(t){throw new Error(t)})),[4,this.getDB];case 1:return e.sent(),t&&"function"==typeof t&&t(),[2]}}))}))},t.prototype.close=function(){var t;return f(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,this.db];case 1:return null===(t=e.sent())||void 0===t||t.close(),this.db=null,[2]}}))}))},t}();t.DataTypes=o,t.default=p,Object.defineProperty(t,"__esModule",{value:!0})}));
